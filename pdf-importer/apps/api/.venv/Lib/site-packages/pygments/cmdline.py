"""
    pygments.cmdline
    ~~~~~~~~~~~~~~~~

    Command line interface.

    :copyright: Copyright 2006-2025 by the Pygments team, see AUTHORS.
    :license: BSD, see LICENSE for details.
"""

import os
import sys
import shutil
import argparse
from textwrap import dedent

from pygments import __version__, highlight
from pygments.util import ClassNotFound, OptionError, docstring_headline, \
    guess_decode, guess_decode_from_terminal, terminal_encoding, \
    UnclosingTextIOWrapper
from pygments.lexers import get_all_lexers, get_lexer_by_name, guess_lexer, \
    load_lexer_from_file, get_lexer_for_filename, find_lexer_class_for_filename
from pygments.lexers.special import TextLexer
from pygments.formatters.latex import LatexEmbeddedLexer, LatexFormatter
from pygments.formatters import get_all_formatters, get_formatter_by_name, \
    load_formatter_from_file, get_formatter_for_filename, find_formatter_class
from pygments.formatters.terminal import TerminalFormatter
from pygments.formatters.terminal256 import Terminal256Formatter, TerminalTrueColorFormatter
from pygments.filters import get_all_filters, find_filter_class
from pygments.styles import get_all_styles, get_style_by_name


def _parse_options(o_strs):
    opts = {}
    if not o_strs:
        return opts
    for o_str in o_strs:
        if not o_str.strip():
            continue
        o_args = o_str.split(',')
        for o_arg in o_args:
            o_arg = o_arg.strip()
            try:
                o_key, o_val = o_arg.split('=', 1)
                o_key = o_key.strip()
                o_val = o_val.strip()
            except ValueError:
                opts[o_arg] = True
            else:
                opts[o_key] = o_val
    return opts


def _parse_filters(f_strs):
    filters = []
    if not f_strs:
        return filters
    for f_str in f_strs:
        if ':' in f_str:
            fname, fopts = f_str.split(':', 1)
            filters.append((fname, _parse_options([fopts])))
        else:
            filters.append((f_str, {}))
    return filters


def _print_help(what, name):
    try:
        if what == 'lexer':
            cls = get_lexer_by_name(name)
            print(f"Help on the {cls.name} lexer:")
            print(dedent(cls.__doc__))
        elif what == 'formatter':
            cls = find_formatter_class(name)
            print(f"Help on the {cls.name} formatter:")
            print(dedent(cls.__doc__))
        elif what == 'filter':
            cls = find_filter_class(name)
            print(f"Help on the {name} filter:")
            print(dedent(cls.__doc__))
        return 0
    except (AttributeError, ValueError):
        print(f"{what} not found!", file=sys.stderr)
        return 1


def _print_list(what):
    if what == 'lexer':
        print()
        print("Lexers:")
        print("~~~~~~~")

        info = []
        for fullname, names, exts, _ in get_all_lexers():
            tup = (', '.join(names)+':', fullname,
                   exts and '(filenames ' + ', '.join(exts) + ')' or '')
            info.append(tup)
        info.sort()
        for i in info:
            print(('* {}\n    {} {}').format(*i))

    elif what == 'formatter':
        print()
        print("Formatters:")
        print("~~~~~~~~~~~")

        info = []
        for cls in get_all_formatters():
            doc = docstring_headline(cls)
            tup = (', '.join(cls.aliases) + ':', doc, cls.filenames and
                   '(filenames ' + ', '.join(cls.filenames) + ')' or '')
            info.append(tup)
        info.sort()
        for i in info:
            print(('* {}\n    {} {}').format(*i))

    elif what == 'filter':
        print()
        print("Filters:")
        print("~~~~~~~~")

        for name in get_all_filters():
            cls = find_filter_class(name)
            print("* " + name + ':')
            print(f"    {docstring_headline(cls)}")

    elif what == 'style':
        print()
        print("Styles:")
        print("~~~~~~~")

        for name in get_all_styles():
            cls = get_style_by_name(name)
            print("* " + name + ':')
            print(f"    {docstring_headline(cls)}")


def _print_list_as_json(requested_items):
    import json
    result = {}
    if 'lexer' in requested_items:
        info = {}
        for fullname, names, filenames, mimetypes in get_all_lexers():
            info[fullname] = {
                'aliases': names,
                'filenames': filenames,
                'mimetypes': mimetypes
            }
        result['lexers'] = info

    if 'formatter' in requested_items:
        info = {}
        for cls in get_all_formatters():
            doc = docstring_headline(cls)
            info[cls.name] = {
                'aliases': cls.aliases,
                'filenames': cls.filenames,
                'doc': doc
            }
        result['formatters'] = info

    if 'filter' in requested_items:
        info = {}
        for name in get_all_filters():
            cls = find_filter_class(name)
            info[name] = {
                'doc': docstring_headline(cls)
            }
        result['filters'] = info

    if 'style' in requested_items:
        info = {}
        for name in get_all_styles():
            cls = get_style_by_name(name)
            info[name] = {
                'doc': docstring_headline(cls)
            }
        result['styles'] = info

    json.dump(result, sys.stdout)

def main_inner(parser, argns):
    if argns.help:
        parser.print_help()
        return 0

    if argns.V:
        print(f'Pygments version {__version__}, (c) 2006-2024 by Georg Brandl, Matthäus '
              'Chajdas and contributors.')
        return 0

    def is_only_option(opt):
        return not any(v for (k, v) in vars(argns).items() if k != opt)

    # handle ``pygmentize -L``
    if argns.L is not None:
        arg_set = set()
        for k, v in vars(argns).items():
            if v:
                arg_set.add(k)

        arg_set.discard('L')
        arg_set.discard('json')

        if arg_set:
            parser.print_help(sys.stderr)
            return 2

        # print version
        if not argns.json:
            main(['', '-V'])
        allowed_types = {'lexer', 'formatter', 'filter', 'style'}
        largs = [arg.rstrip('s') for arg in argns.L]
        if any(arg not in allowed_types for arg in largs):
            parser.print_help(sys.stderr)
            return 0
        if not largs:
            largs = allowed_types
        if not argns.json:
            for arg in largs:
                _print_list(arg)
        else:
            _print_list_as_json(largs)
        return 0

    # handle ``pygmentize -H``
    if argns.H:
        if not is_only_option('H'):
            parser.print_help(sys.stderr)
            return 2
        what, name = argns.H
        if what not in ('lexer', 'formatter', 'filter'):
            parser.print_help(sys.stderr)
            return 2
        return _print_help(what, name)

    # parse -O options
    parsed_opts = _parse_options(argns.O or [])

    # parse -P options
    for p_opt in argns.P or []:
        try:
            name, value = p_opt.split('=', 1)
        except ValueError:
            parsed_opts[p_opt] = True
        else:
            parsed_opts[name] = value

    # encodings
    inencoding = parsed_opts.get('inencoding', parsed_opts.get('encoding'))
    outencoding = parsed_opts.get('outencoding', parsed_opts.get('encoding'))

    # handle ``pygmentize -N``
    if argns.N:
        lexer = find_lexer_class_for_filename(argns.N)
        if lexer is None:
            lexer = TextLexer

        print(lexer.aliases[0])
        return 0

    # handle ``pygmentize -C``
    if argns.C:
        inp = sys.stdin.buffer.read()
        try:
            lexer = guess_lexer(inp, inencoding=inencoding)
        except ClassNotFound:
            lexer = TextLexer

        print(lexer.aliases[0])
        return 0

    # handle ``pygmentize -S``
    S_opt = argns.S
    a_opt = argns.a
    if S_opt is not None:
        f_opt = argns.f
        if not f_opt:
            parser.print_help(sys.stderr)
            return 2
        if argns.l or argns.INPUTFILE:
   TvZ)%$?.N[Jǰ((c}+M5s|IG\&#N5h;K+p]{.A7gO>Fl="7^oYWs%@v`Ob$tó	3>5f}1uS*w'A5_Y+w	S<{	񅧃5u0Ď{l{Z!|. fWrFsڜIs\`3Zڡ>evX)qg-h@nv`qm3HїWɘR0s	ME~<%@RM3\)8#صajuqpOgn,&19	"h7XDo=p7j_,V ~+}4fZ9 jwd}?Z+s#qB:\C51.T;iUSŉBp<	{\kh!}zuICNlƿ͊nϓNWhf떠]eHX̍g_[[a*E5x*^*ؐU$aID8Y0$X`*E@1Ne.~ƻ~0X./gAHT{1pACq?="z+bA/h=G)Y)JeЛySz&jOH^<JroQ  .dpLq8dyftW콲؝:{;jfFxJ\)g̀Qs#զHet:P3'Mk<iQ4,J٫6A&RV0-ZǕm'kjku$	$¸vRzS@L9悕J%n4^Wʫé`^wuy/8ejQC|fp24h=_OԒEfrk]*Wx76˛+K;!񟫙\OAp.3'B Gv	()TkVnL[Kc
C"߂Crto	`~ppqeڔCazH)dN8 u'7iwPwwƷ5b@_!ȳ7CH-b6eB.,l^șGzg>?YIv̌%T@Pt$*gL;wkBSi{L?!u2Pl"T`B/=>dLXsO#9_5Ȼ
ocm68$m@֘0Ao	rgspuXor$˨blS$KP]Bʭ(ys@6+*zr't,6ҏJC~vpXCyEf^uYchVgV6(c'U#ty͝.Yu2(K%{9_"\.<BK|^|M~EٰˑpKnN+R({4w(n^Vr7Վoѕ)]lTsH$TF!IEO'@Ck   :Ԛx\t>}l;CE
x	LƎ{PHEۚj)뭠LXyKƱ%qucOZOѡ74.^ůakFB}k<E9W
&7H8ؾC>=nosB\Xєϣ? XuldTE\њp+S8XDeN-:cs>0.mBv%(yb o[1;tQ4=G(j7|OT1#&nٸjS53Km>0cYIc(Ize=Q.-nƤ	~aJmkrK+LutA":07g+!iÌpTrэKGt=Z̸Iض$F<+ܶ!Ft50M=|eKۉ)ß2
P-ҍ'ε&;JHKg,u[uUlA	u4N߽;`V><6)\cdc􌓋SA7>gu]6LAR=U<Nawtc)r;PJL!x=σi9{čwwͧQ?f0|X6"6I^'!<Jv$͝3{hY+]7(FUлcHg^2DE4MgT-k&-Ѭ1Ѐl_F(q%vӕN69W<֔V/M(|IsE'':Vspf{5;12CCֻ(Ea)鰜euNPv]~1!%DwEǴ)B@fVxzX,YIeM?V/WkUYTjTkoaLr4,!) 0r{JGuDoݹԁkLh]7k)pA+?6|c, K\qlv^!*}!k @2w_;%CZ<_'uS~.1~..DDS]
*ZL";x"2`d56^6].(#.b{\|]~x:tM]G?$ WC_	H!|p5D$S4Y1;X b+C;H/*6FwV@O7>b.z5yƵ';5YmJ$wL_LYi]L\&h3s!_ynɾYANezg8Оǉ{X!<xEBD\"44ۤ=VwlBYV'^e,/͚>]r@	Q,\H{R\l^؉q[LTyM4.z@؂ZF&##	d&\c-*hjQI؉v0íqMcO;;ѳ@J/ұN`љ5i5 #@mؓO/tW ˌclH4o'@l>1lHLkAW3+WjhhApBUե$7¤$
dc<'2S6]Tnޛ\n%`aIE9_-/Mo%n<K֜QEW ",l|RT~LJ
Z:
8"ĺ5AH:JВHYMuc9s,Q#\jzZ]H0 axVZ?S9LvvHLdNP%[)6Q3XY#n&3oDU9< BڌAql'h N>~pLBiwxz~g<c~0~4>P];`-=[yzO?ZjyUV+!yj]s7i;%@%I;:D0~-3 [
>ZWD|e0 ߦ[>'G)9*;=>1icKd!߆;7kLt?7l;[{!{+Z,bcoaxܥ!UokM6%F嚉hCqF69-ڲ{DAnczJL]=U_D.DhvCϱ

=	Kp`
l}s`_-'.U\E!=o)>N:<atO+eu Ȥ=@	M\r"$ U?vʾ~KFw;l%J$YM+#.;` w,^w7vX't/{5{C0|SlYs	HVʭR=9>n\֍?cEjOFX0CJԙ)%%b9v\^Z5ID$1|;76CJ!(|{[_0i:Y*ydhy?UTQ8ޓsn!LOy>s尹cJ?.rX0OzLQT&t:`x!h	
PL*HV^У&;m9-@9nBul,A7,
#W/xE`LBjwEIwW-ރuۿ&TaC\(s.	Q_+R>[ǘ@vƒdwn{dtSyAt?~4WZ@/ "c.zHdLzEtNNZ@r3pT@|Lqx0.u{@dbyYޒ3a~1ֳraZkBڌ)٪dfSei|jG.1BQ~gv@X@$<I?9nDNΕ8M8O/	0Xlc$:`g&ov0.VB,Fz-Oy^+"H)l픹Wy^vܘMvQo	8ȶۧډ _qZ?#.b@%ҷ/k3O\Qje,[Ң@QPѫl_E{W'G%1J\NZixe(.19؁;.I0k:iwKXΙ?0KLBΆW&[A$fH8H=.7Ԣ@+VH.&k1We@ws ǻRi?k횭t^?L 8Sp0Vy_j/>{t*Sok`+nh̆GEq<:-sxc}Y#(`'.)ȓ?N:UI{iTGuP
RB""Pk2/pG3g7P32~&c&aߓ0*OGM0E
5EDj	h.{m=.SХ!%~BYb26$po-]]~6 g;mXm}&_&FAQq7lbm.j:G,D++RDd<X
̠BIIFӀ54PoedYhI=SO76*h:G5틺In߁%;X뫜='i$nm	c}NմR6_J7dݰX`J *c_zg5vn>֢[(x\מ?xxhcM,X(0G߀yl÷D8m6d"k;YΌ"	tGTɹ3:͝57+:F*;0SĀf^:Doe؜2_os rFF[z;JL!YS6$Sx+ɥ{>Wz!YQ/VȌ:8I<<A	/׿ ɀ&)onrR)M2|zp<J%4Ղ-_
g?ҍ)ޥO˃Sbޤ180944P=Aj
Qy~=E=p^E42vyρ1@7Vqj6KABI,շA/  \?t lbzI'-&IɔQDeCc<-F΃pQ7.s`q'*~./+PW8VٜFDT-?]?s_p}w?(댺/8&\5vA~M$(
#]B➕
Z/g U|>[L 7s_\έ'۞'DGCɬs6~Fat:_cd'$Sє\:$:7bK-D>bUL}]Ƚ-GGL_͏%\W=djxDXg\1oӤ+9*yq|N!)!tIhH0e?EöwJ~AI R35LN7JVfŰh5R{Q<C/(q	$K&ת&ԝJ"Td"t=
DA7ۍo#(4E$ZgxDLFSI	E.2*(R]	jAX=jByl"6Rw)
H約CεjJ8`U7Gfq׋T:,܋l_+F[EKC5,y?dsB)#@e)n*(>NGYgYm`nLu!(jzb°tUx4>@ݏbqyo4vOJiwUQ4(]L}#9vxO_,LFS[)A8pGUIߥ޶u$Hљׇӈ @9; :#zv该#GCyaן9!Q/nb­t(܁9jtNfu?ZYS	~H'WIvp(Iɶ~	e/2.kR8WO"'w7A;q?~NORm^zY~ŵ,B^rB(kH,G@mq3[{xM^'[xT+2}o׹'("7(RԼZ "Zs(Sw!B!G}.mqݸ}0?n60f`ɾJO'Оґ7G)}չoQJ5TKm1<:iĠ#;ל=;@qX,3iߑ}(ױ.¢V%9E/3	.4zk#͌m%iFTqKYVEQ[~a|CDMܒ	581mՈt'Msd	ROh:(Ql($k-n6 ,:Wѷ7h I?XV)EP&#}w=z+ft	*U}W)sp>?dQ*K/z65@%-}x&=}ޥc4mYhp}q;!hq(|[8Y!#`b(>EhT) h`QI:lb``\o!48t|-a}-qηɣopmT'V_1udl5u&Ō0/p|Wt#`D>\Qn+?jq3GtG`yJN`ig#xb%Us(/a+/<	zm1\jEa:itYw,*E8&dX9Ȇ ~N'{"矯O_Eg}KJ]3o6l+ϫО.FvB({3F& osȨǯF߹Ջx;+
h\z9Y padrr_478ٿQĠPrpInG0IdA/Ho5C^;@<Y»Mi!/Qd8Q"E"I4a.'|Q⤈\1y6b]ғ@j%%9HƁ>*w8ZPZBj|56)QX!Gv;- }wה9UI7»U *4oH}̾\iƼT0lbNs'Nˬw߰GDң9hƞ/s*D](W{dvWșhL?R̤p!Ў!Hl)T9chJݨFGrgg8Hgd`ft	8Y*1̈́C3/M[+{Ε<= Eb(jQA@a[RW>XR]CW +3oB2;zXr)9һ3"};[Ȼ<-?	{3BRH.+׊!h6)WaEdx\2=F9[s|8cǧRALdzBp,{+h\)4ɍv[UOqUmihi`!0~Iq:?:q2ml^\ϢӀ{qCiު-Zf^͠Q?&7Зtqzw,xLz~^j:'%GnNACc,0mNB"pkZ6bs@p8G7{Mi9F'	.HqSћx+@SʓO1oO2:i؀3Lz|I3f#9\zΎ);/598̇}ߏ"TŶe/*W`<]F/S)07S^<^ubS
%Cu5
vk{ivlf.z8ն4nv8B-I8mF#9s񟧺3|/օcأ-%s^>:<ob[,/R\~ZggQ}bhMQMϊӯۮsHtTY'>~wwA)4u~%DoУ!lD`!H	 5>D7@ցNmLLIT,쩤=mޚڈmRzBA߂@8W0pT&H^.:TBYg3MV)`עe_咆?dKY͠̓N)7y].T eX`O}h9U (cǊo>!֖Ef4x&%&SzV=XpCy|ɬ/ٚ ӵ.0d])h1!XngLwi^<t[6%+wP$ӧ{%Y-b+]M&j]Tli m*P|ŷɇcBUSRY~3t͉&	H][^ؖQاE5lX;wTyT["Xm
*)F(<q^e7l7#{A}bCzܼDnb	|Y{yWoAbtrŢG8!Fmm;U|HG4g0,Q	#~VRK[ϓiбT"ʓ
LSszҎ:v@~}qM䕪V'Ƒj<&Vc.X-1d3g=/T9AFr
<C?;İ}BZ LHj⦥H^8V8GYyv{ 	*N@BUMKxq9t/'YBz|W[䞢kdXcA`S/l@R\#*EE7,\@V+\鉀Jw۠CA-Jm7&X䧁?4˩M3v:N]Nw]7\gK#z5Р `uĕv77c(ʧ(3$xv3?PNq0HJDk++?@)0R%/41 ^d)i!Iiy49fwTob\eg@^G6ա
_7R}zd?ߢ.fx}/NIe<Jd5.Oz[GIUm*.5έ cL܆nV-$kNY)TOٴ<7~k\3iGe\{e@zmBU~E~FoõKFDs3>}+a}U#
P,iJJ[_#xn#]L㡛a416rAl<Aw;,)]y>L }QND"k$$:ҰK:!<רZg@%(6:g(` TclB|H_(,IAiT<2Ҟ4ݡhT]s$NFHN1]%}}IxC,So|w
ѪRǲ$T fil[)"D(LY]>;Brhy*WM'_v=_MϹ&YY̻^uF/D
6j;o17*,W2tǪ&Dˢ{I8-#KУ'6zttXg/Rl{v)~
z%8/-CJh^r+Lh2m	Yg0bG[ qYMCK%ȼշhL̀T/Xŋj6tW]vҡTDYk`HZN @k,os,(b*Tr
[a.8i?kI% 1Xw9HKM
PٸKiw(A+_5!;3yAx.jxZ,þ+̫Bkffm_p#;	}13;9u!f"%00 6),&V`tZOz]AMQ] t+w6iTAV8;y9HKܾ^nk j1?\N
΀QAryY[hBy݁}pY1 YECgneW<-thWZس`lw|	L|/8ݒou$ TJKA?ľ{[KhVrweg4aJDi6#Z*&D<n=q%{Gy|[aVҌ&^@sx0`|WcJbڦ)yzۃ?Zğ!w?x')bpfjkxC)U>dIh͈0h׮p?jE7d`·.Lܬ.G̧fBr\#`H7m*ƲŐKĆiu]6k4[GcC2`}g
ӌ(S.틳+x[텍sn'#ѿ3Ę-rsQ%}&dTLlx(PT3
.$cv
	 j$7^}a'(]WD;3+69!2hbH_G;^U)QOvLTgA\weO^iSP>B_gէ?KJ8㟱5ܳkAgMʴ
CB_I\d?
mQ|k%< %_'2_ىc93^I8}_F|rEQ߈yC,9ǀu ](e ~+S0FkJTE
*ޣ>b#Sǂ2r&CmBJB|UMOOi9k+`	%Ys?cFLեl?@-]nIGl*x}*r0-UPHb/,PfoaW8C5<N]I%]mRPUܴIS/j3&%tf!*M2&[Gf%TZ>OwcEt0Xn zm)a"R>pn7le8K7%Hp{HvtH*XznB:	k.BYfez})FRI^CÞzc(֡MV+I	?nvMOrr.
:,Jzfb(ɘ	(7+NxQ5܈Bȯjt~Z-'jK"}Q
eq~rk5+>SLJuuR)ˮBh:&GwuS"9[uX7Ts*SL{l|`E'(k:1W]~S$Hho9xSM]Zz׾P^ np{]@i+eʖ
UPR!;M_$V %4C[з8Q29ЮxW9'DKb9<
*}$#,,vRv	8JsܨrʘD"2rFv5xWUc8]c;HY:]agyʿ>Gο  Rqa܈tyhswһx9<&DwR!'KW}APĻ̙,NLZt/@A|##[	o)pN7k	#CGF]:\
9c1W~Z\F!SUIKEe7иq$Ey E=-춲J>]P}IE&8yRTȑo&:E:p<6Q?ů
)H,,q<j-hzOWVFךYM-PW5rJɟk0[ݞ Y+xEfZ' DpJ[b9PRe' MyuGo|8v>ś"G{ ]d8iaX6ݙ1w/9gYIA$ARdoZK0-uǚwIұU4(֢\q.Ȗ1xGkȠxybhpE8])2|ͰS'#U|[F~I	G(z1x:鰿?Ǌ46L
48yy׸dOjn()l%i^LCw]%Ɖ;D0/O#y0KВLo|#bx #wVa;>r;	/;+#w'o*sIA!m[փ牪'W%$QZl2`o)h3! pݾdt'Dt6yƤu=Бh7=zTr ܮT*F̸ky汱#
Rk
nkWZJg_p|3xxZm;=7+ M~2eī0_1dzg/AF/@G[MW ǡR |]~o%6%~_;p-=[PL+ԁ1-KCI#H@n
.-Ƨ0ծMtދgQruCfDrb	IE(KE{)O	:-au;LRK~Ѷeߥ0:DgXD:~cr!
XsyB@z L8o}k	9U-^Z"_pXeL@G(,`>ۿ)}G:jsRtSgд8N-F@;tuA%©5r̒MzOHݐ# .\_1m}ϏD+Gӓ'1>r(j<	A0Mdٟ\YJ2 
L!Izc/n=^9c=PaKS5Ηdgv(CO,o>e(ǔ~1Hq*ӶM AJYlbcn,r$DLf^UfVқbH-⢉4<th4T/`lJmr{A8ԑ#f/<o`U}wA$oYN2Q^lfeQ:$?tcBphW+/dV>~ZZq~P}x6vPbAشt0P ->Y೪sSr>ΈȞNI-kxwvvh;{}{;BR^&gByKPԤ3w3cy?n{,BO
"{Gv'1HUR2S:lUf&	G,(֟QC)!'R\2ivHpmRTTs.E~gۦ%sk*W.VīUSG
Cv	~ѼLVIBZWj8%U!ȣٙf
O&-_Ԙ)R]Ta$%$6NVTC%b>C2/n)|c||yY޹ٚ԰J{@m'kg}62d"#hŴ03KaV;$jjܳAAB* JBj\h:Ғp$чi,*ԥ"s~֧qX6q"JW,+
WK ?2q"e.h$#e!4	IކݖZm#xSwe-V\U0Īn5v|{EG@αf3۷}h!6R1\ڎV8$\DAl۶/I)(`dGɼ